YYYYWEEK 
=============================

本文将介绍YYYYWEEK函数的使用方式。

描述 
-----------------------

根据分库键时间值的年份与一年的周数计算哈希值，然后再按分库数进行取余。

例如，`YYYYWEEK('2012-12-31 12:12:12')`等价于按照(2013x54+1)%D（D是分库数目）公式计算出2012-12-31是2013年的第1周。

使用限制 
-------------------------

* 拆分键的类型必须是DATE、DATETIME或TIMESTAMP中的一种。

* 使用YYYYWEEK函数前，需要先确定所需的总物理分表数，您可以通过确定循环周期（如2年）来确定总的物理分表数。因为YYYYWEEK函数仅支持为循环周期内的每一周创建一张独立分表。

* 当周数经过一个循环周期后（如2012年第1周经过一个2年的循环周期后是2014年第1周），相同周数有可能被路由到同一个分库分表，具体被分到哪个分表受实际的分表数目影响。




使用场景 
-------------------------

YYYYWEEK函数适用于需要按年份与一年的周数进行分库的场景。建议结合该函数与`tbpartition by YYYYWEEK(ShardKey)`命令一起使用。

使用示例 
-------------------------

假设PolarDB-X里已经拥有8个物理库，现有如下需求：

* 按年周进行分库。

* 同一周的数据都能落在同一张分表，且两年以内的每一周都能单独对应一张分表。

* 查询时带上分库分表键后能直接将查询落在某个物理分库的某个物理分表。




YYYYWEEK分库函数即可满足上述要求。上述需求中提到两年以内的每一周都需对应一张分表（即一周一张表），由于一年最多有53周，所以需要创建106（53x2=106）张物理分表才能满足上述需求。PolarDB-X已有8个分库，所以每个分库应该建14张物理分表（106/8=13.25，取整为14，分表数最好是分库数的整数倍）。

则您可以使用如下建表DDL：

```sql
create table test_yyyyweek_tb (    
    id int, 
    name varchar(30) DEFAULT NULL,  
    create_time datetime DEFAULT NULL,
    primary key(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 
dbpartition by YYYYWEEK(create_time) 
tbpartition by YYYYWEEK(create_time) tbpartitions 14;
```



