调优基本概念 
===========================

分布式数据库相对单机数据库架构有差异，所以在单机数据库的调优经验上分布式数据库又有着自身特点的调优手段。在使用PolarDB-X的过程中，我们会基于统计信息、执行计划和并发策略和执行之后反馈的运行时长等信息，找出导致SQL执行慢的原因，针对性调优。

基本架构 
-------------------------

PolarDB-X是一款计算存储分离的分布式数据库产品。当一条查询SQL（称为逻辑SQL）发往PolarDB-X计算节点(CN)时，PolarDB-X会将其分成可下推的、和不可下推的两部分，可下推的部分也被称为物理SQL。不可下推的SQL在CN上执行，下推的SQL在DN上执行。

![基本架构](../images/p332458.png)

原则上，PolarDB-X在查询优化过程中尽可能按照以下规则做执行优化：

* 尽可能将用户SQL下推到DN上执行，除了可以避免CN和DN间数据网络交互以外，还可以充分利用多分片并发执行的能力，利用各个DN资源，加速查询。

* 对于无法下推的部分算子，优化器会选择最优的方式来执行，比如选择合适的算子执行、选择合适的并行度策略以及是否使用 MPP 执行。


除此之外，在执行优化过程中会考虑尽可能选择最佳索引。

基本概念 
-------------------------

在SQL调优过程中我们还需要理解下列概念：

* 逻辑SQL: 用户侧发起的查询SQL；

* 物理SQL：SQL经过查询优化后，一般会拆分为可下推和不可下推的SQL，其中可下推的SQL是发往DN执行的，叫物理SQL。如果逻辑SQL被全部下推到DN执行，那么物理SQL等价于逻辑SQL。

* 并行度: 指查询过程中数据并行执行的最大数目，对于CN来说就是利用多核能力多线程计算，对DN来说就是同时执行多个下推物理SQL的并行数。

* 执行计划：逻辑SQL发送到CN节点，会经过解析优化生成可执行的计划树，计划树的每个节点代表是算子。一般可以通过执行计划初步断定查询的快慢，比如是否命中索引、算子选择是否合适等。

* 索引：PolarDB-X一般分为局部索引和全局索引，局部索引指的是单个DN节点的索引(MYSQL索引)，全局索引是指构建在多个DN上的分布式索引。选择合适的索引，可以大大提高PolarDB-X的检索速度。


一条慢查询可能和物理SQL执行快慢、并发度数量、执行计划和索引选择是否合适都有关系。所以在分布式数据库中，SQL调优的成本一般会比单机数据库高。

